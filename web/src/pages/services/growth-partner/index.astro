---
// src/pages/services/growth-partner.astro
import Layout from "../../../layouts/Layout.astro";

const siteUrl = "https://brandsbuilders.agency";

const seo = {
  title: "Growth Partner — Web, Local SEO & Paid Media Operated Together",
  description:
    "One accountable engagement where we design, ship and operate the growth loop: web, local SEO and paid media — tracked, tested and tuned to revenue. Entry via Free 72-Hour Growth Sprint.",
  canonical: `${siteUrl}/services/growth-partner`,
  keywords:
    "growth partner Alberta, web SEO paid media, CRO Alberta, owner-led SMB marketing, lead generation Alberta",
  ogImage: `${siteUrl}/images/og/growth-partner-og.jpg`,
};

// No branding pillar. Ads included.
const pillars = [
  { title: "Web & Conversion", points: ["Fast, accessible pages (Lighthouse ≥90 mobile)", "Message-match landings", "CRO & light A/B testing"] },
  { title: "Local SEO", points: ["On-page SEO (titles, H1–H3, schema)", "GBP hygiene & posts cadence", "Reviews workflow & prompts"] },
  { title: "Paid Media", points: ["Audit & tracking sanity (GA4/pixels/UTMs)", "Keyword/angle research & ad structure", "Data phase (~$50/day), negatives & scaling"] },
  { title: "Measurement", points: ["Single source of truth dashboards", "Lead/revenue attribution sanity", "Insight report: what changed, impact, next"] },
];

const how = [
  {
    title: "0) Free 72-Hour Growth Sprint",
    note: "Fast, risk-free entry. We review public signals and send a 2-minute Loom with before → after opportunities.",
    bullets: [
      "Pick one: Landing speed & clarity OR Google Business Profile visibility",
      "We show measurable lift ideas first — no access required",
      "If there’s fit, we move to Setup Month"
    ]
  },
  {
    title: "Setup (Month 0–1)",
    note: "You own the site/code/content from the moment we ship.",
    bullets: [
      "Tracking & attribution sanity (GA4, pixels, conversions, UTMs)",
      "Web foundation (new build or refactor) with accessibility essentials",
      "On-page/local technical SEO pass + schema",
      "Initial keyword & angle research; ad account structure ready",
      "Dashboards & alerts (lead/revenue, CWV, anomalies)"
    ]
  },
  {
    title: "Operate (Month 2+)",
    bullets: [
      "CRO cadence (A/B copy/CTA, form friction fixes)",
      "GBP & local pages maintenance; reviews engine",
      "Paid: query mining, negative keywords, pacing & scaling",
      "Insight report: what changed, impact, next steps"
    ]
  },
  {
    title: "Performance Layer",
    bullets: [
      "Services/local: lead targets with clear definitions",
      "E-commerce (if applicable): revenue share on attributable lift over threshold",
      "All incentives documented; no attribution games"
    ]
  }
];

const fit = [
  "Owner-led SMB (2–10 employees) with capacity to absorb demand in 30–90 days",
  "High-value services (≥ $150–$400 per appointment) or healthy AOV e-commerce (≥ $60)",
  "Based in Alberta (Calgary, Edmonton, Airdrie, Lethbridge, Red Deer)",
  "Willing to publish changes quickly and collect reviews consistently"
];

const notFor = [
  "‘Fully booked’ teams or no operational capacity",
  "Four–five decision-makers for each change",
  "Promises like “#1 on Google in 2 weeks”",
  "Budgets that can’t sustain testing or ~ $50/day data phase for ads"
];

const guarantees = [
  { h: "Performance", p: "Mobile Lighthouse ≥90 and LCP < 2.5s on new pages (trade-offs documented)." },
  { h: "Accessibility", p: "WCAG 2.1 A/AA essentials on shipped templates." },
  { h: "Ownership", p: "You own domain, code and content from day one." },
  { h: "Clarity", p: "One plan, one report, one accountable partner." }
];

const faq = [
  { q: "Is this a bundle of services?", a: "No. It’s one operating model. Web, Local SEO and Paid Media are run together only if they’re required for the growth plan." },
  { q: "Do you publish prices?", a: "No. Investment is aligned privately after the fit call and depends on scope, speed and channels involved." },
  { q: "Do you run ads without changing the website?", a: "Only if tracking and landings already meet our standards. Otherwise we fix foundations first, then launch with a ~ $50/day data phase and add negative keywords continuously." },
  { q: "How fast are results?", a: "Most owner-led SMBs see meaningful movement in 30–90 days when changes publish quickly and reviews flow steadily." }
];
---

<Layout seo={seo}>
  <!-- HERO -->
  <section class="relative overflow-hidden bg-gradient-to-b from-slate-950 to-slate-900">
    <div class="pointer-events-none absolute inset-0">
      <div class="absolute -top-24 -left-24 h-[30rem] w-[30rem] rounded-full bg-violet-600/20 blur-3xl"></div>
      <div class="absolute -bottom-24 -right-24 h-[30rem] w-[30rem] rounded-full bg-fuchsia-600/15 blur-3xl"></div>
    </div>

    <div class="container mx-auto px-6 relative z-10 py-16 md:py-20">
      <div class="max-w-4xl">
        <p class="inline-flex items-center gap-2 rounded-full border border-violet-500/30 bg-violet-500/10 px-3 py-1.5 text-violet-200 text-xs mb-4">
          <span class="inline-block h-1.5 w-1.5 rounded-full bg-violet-400"></span>
          Entry via Free 72-Hour Growth Sprint • Alberta • 9am–9pm daily
        </p>
        <h1 class="text-4xl md:text-5xl font-black leading-tight text-white mb-4">
          Growth Partner
          <span class="block bg-gradient-to-r from-violet-300 via-fuchsia-300 to-indigo-300 bg-clip-text text-transparent">
            we operate your revenue loop
          </span>
        </h1>
        <p class="text-slate-300 text-base md:text-lg max-w-2xl">
          One accountable partner to design, ship and run the loop: fast pages, Local SEO, reviews and paid media tuned to revenue.
          No public packages. Start with a free, no-risk 72-hour sprint.
        </p>
        <div class="flex flex-wrap gap-3 mt-6">
          <a href="#how" class="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 px-5 py-3 font-semibold text-white">
            See how it works
          </a>
          <a href="#free-sprint" class="inline-flex items-center gap-2 rounded-xl border border-slate-700 px-5 py-3 text-slate-200 hover:border-violet-500 hover:bg-violet-500/10 transition">
            Apply for Free 72-Hour Sprint
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- PILLARS -->
  <section class="py-14 bg-slate-950">
    <div class="container mx-auto px-6">
      <h2 class="text-2xl md:text-3xl font-bold text-white mb-6">What we operate</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        {pillars.map((card) => (
          <article class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
            <h3 class="text-white font-semibold mb-3">{card.title}</h3>
            <ul class="space-y-2 text-slate-300 text-sm">
              {card.points.map((p) => (
                <li class="flex gap-2">
                  <svg class="w-4 h-4 text-violet-400 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  {p}
                </li>
              ))}
            </ul>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- HOW IT WORKS -->
  <section id="how" class="py-16 bg-slate-900">
    <div class="container mx-auto px-6">
      <header class="mb-8">
        <h2 class="text-3xl lg:text-4xl font-bold text-white">How it works</h2>
        <p class="text-slate-400">Free Sprint → Setup → Operate. No public pricing.</p>
      </header>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        {how.map((blk, i) => (
          <article class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-white font-semibold">{blk.title}</h3>
            </div>
            {blk.note && <p class="text-xs text-violet-300 mb-3">{blk.note}</p>}
            <ul class="space-y-2 text-slate-300 text-sm">
              {blk.bullets.map((b) => (
                <li class="flex gap-2">
                  <svg class="w-4 h-4 text-violet-400 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  {b}
                </li>
              ))}
            </ul>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- FIT / NOT FOR -->
  <section class="py-16 bg-slate-950">
    <div class="container mx-auto px-6">
      <div class="grid md:grid-cols-2 gap-6">
        <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
          <h3 class="text-white font-semibold mb-3">Who it’s for</h3>
          <ul class="space-y-2 text-slate-300 text-sm">
            {fit.map((f) => (
              <li class="flex gap-2">
                <svg class="w-4 h-4 text-emerald-400 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                {f}
              </li>
            ))}
          </ul>
        </div>
        <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
          <h3 class="text-white font-semibold mb-3">Not a fit</h3>
          <ul class="space-y-2 text-slate-300 text-sm">
            {notFor.map((n) => (
              <li class="flex gap-2">
                <svg class="w-4 h-4 text-fuchsia-400 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                {n}
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- GUARANTEES -->
  <section class="py-16 bg-slate-900">
    <div class="container mx-auto px-6">
      <h2 class="text-2xl md:text-3xl font-bold text-white mb-6">What we guarantee</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {guarantees.map((g) => (
          <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-5">
            <h3 class="text-white font-semibold mb-1">{g.h}</h3>
            <p class="text-slate-300 text-sm">{g.p}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="py-16 bg-slate-950">
    <div class="container mx-auto px-6">
      <h2 class="text-2xl md:text-3xl font-bold text-white mb-6">FAQ</h2>
      <div class="grid md:grid-cols-2 gap-6">
        {faq.map((f) => (
          <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6">
            <h3 class="text-white font-semibold mb-2">{f.q}</h3>
            <p class="text-slate-300 text-sm">{f.a}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- FREE SPRINT APPLICATION (Netlify) -->
<section id="free-sprint" class="py-16 bg-gradient-to-b from-gray-950 to-gray-900">
  <div class="container mx-auto px-6">
    <div class="text-center mb-12">
      <h2 class="text-3xl lg:text-5xl font-bold mb-6 text-white">
        Apply for your
        <span class="bg-gradient-to-r from-violet-400 to-fuchsia-400 bg-clip-text text-transparent">Free 72-Hour Growth Sprint</span>
      </h2>
      <p class="text-gray-400 text-lg max-w-2xl mx-auto">
        We’ll review your website and Google presence, then send a 2-minute Loom showing quick wins — within 72 hours.
        <span class="text-slate-300"> Limited Alberta slots weekly. No credit card.</span>
      </p>
    </div>

    <div class="max-w-2xl mx-auto">
      <form
        name="sprint-apply"
        method="POST"
        action="/sprint/thanks"
        data-netlify="true"
        netlify-honeypot="bot-field"
        class="bg-gray-900/50 border border-gray-800 backdrop-blur-sm rounded-3xl p-8"
        novalidate
      >
        <input type="hidden" name="form-name" value="sprint-apply" />
        <p class="hidden"><label>Don’t fill this out if you’re human: <input name="bot-field" /></label></p>
        <input type="text" name="trap_url" tabindex="-1" autocomplete="off" class="hidden" aria-hidden="true" />

        <!-- Business + Website -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label for="business_name" class="block text-sm font-medium text-gray-300 mb-2">Business name *</label>
            <input id="business_name" name="business_name" required class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white placeholder-gray-400 focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors" placeholder="Your company name" />
            <div class="text-red-400 text-sm mt-1" data-error-for="business_name" aria-live="polite"></div>
          </div>

          <div>
            <label for="site_url" class="block text-sm font-medium text-gray-300 mb-2">Website URL *</label>
            <input id="site_url" name="site_url" type="url" required pattern="^https?:\\/\\/.*" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white placeholder-gray-400 focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors" placeholder="https://yourwebsite.com" />
            <div class="text-red-400 text-sm mt-1" data-error-for="site_url" aria-live="polite"></div>
          </div>
        </div>

        <!-- City + Annual Revenue -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label for="city" class="block text-sm font-medium text-gray-300 mb-2">City (Alberta) *</label>
            <select id="city" name="city" required class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors">
              <option value="">Select your city</option>
              <option value="Calgary">Calgary</option>
              <option value="Edmonton">Edmonton</option>
              <option value="Airdrie">Airdrie</option>
              <option value="Lethbridge">Lethbridge</option>
              <option value="Red Deer">Red Deer</option>
              <option value="Other (Alberta)">Other (Alberta)</option>
            </select>
            <div class="text-red-400 text-sm mt-1" data-error-for="city" aria-live="polite"></div>
          </div>

          <div>
            <label for="revenue" class="block text-sm font-medium text-gray-300 mb-2">Business Annual Revenue *</label>
            <select id="revenue" name="revenue" required class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors">
              <option value="">Select range</option>
              <option value="under-250k">Less than $250K</option>
              <option value="250k-500k">$250K – $500K</option>
              <option value="500k-1.5m">$500K – $1.5M</option>
              <option value="over-1.5m">More than $1.5M</option>
            </select>
            <div class="text-red-400 text-sm mt-1" data-error-for="revenue" aria-live="polite"></div>
          </div>
        </div>

        <!-- GBP + Platform -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <span class="block text-sm font-medium text-gray-300 mb-2">Google Business Profile *</span>
            <div class="flex items-center gap-6 text-gray-300">
              <label class="inline-flex items-center gap-2">
                <input type="radio" name="has_gbp" value="Yes" required class="text-violet-600 focus:ring-violet-500" />
                <span>Yes</span>
              </label>
              <label class="inline-flex items-center gap-2">
                <input type="radio" name="has_gbp" value="No" required class="text-violet-600 focus:ring-violet-500" />
                <span>No</span>
              </label>
            </div>
            <div class="text-red-400 text-sm mt-1" data-error-for="has_gbp" aria-live="polite"></div>
          </div>

          <div>
            <label for="platform" class="block text-sm font-medium text-gray-300 mb-2">Website platform *</label>
            <select id="platform" name="platform" required class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors">
              <option value="">Select platform</option>
              <option value="Wix">Wix</option>
              <option value="Squarespace">Squarespace</option>
              <option value="Shopify">Shopify</option>
              <option value="WordPress">WordPress</option>
              <option value="Custom Code">Custom Code</option>
              <option value="Not sure">Not sure</option>
            </select>
            <div class="text-red-400 text-sm mt-1" data-error-for="platform" aria-live="polite"></div>
          </div>
        </div>

        <!-- Contact preference -->
        <div class="mb-6">
          <span class="block text-sm font-medium text-gray-300 mb-2">Preferred contact *</span>
          <div class="flex flex-wrap items-center gap-6 text-gray-300">
            <label class="inline-flex items-center gap-2"><input type="radio" name="contact_pref" value="Email" required class="text-violet-600 focus:ring-violet-500" /><span>Email</span></label>
            <label class="inline-flex items-center gap-2"><input type="radio" name="contact_pref" value="Text" required class="text-violet-600 focus:ring-violet-500" /><span>Text</span></label>
            <label class="inline-flex items-center gap-2"><input type="radio" name="contact_pref" value="Call" required class="text-violet-600 focus:ring-violet-500" /><span>Call</span></label>
          </div>
          <div class="text-red-400 text-sm mt-1" data-error-for="contact_pref" aria-live="polite"></div>
        </div>

        <!-- Email + Phone -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Email *</label>
            <input id="email" name="email" type="email" required pattern="^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white placeholder-gray-400 focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors" placeholder="you@company.com" />
            <div class="text-red-400 text-sm mt-1" data-error-for="email" aria-live="polite"></div>
          </div>
          <div>
            <label for="phone" class="block text-sm font-medium text-gray-300 mb-2">Phone (optional)</label>
            <input id="phone" name="phone" type="tel" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white placeholder-gray-400 focus:border-violet-500 focus:ring-1 focus:ring-violet-500 transition-colors" placeholder="+1 403 555 0123" />
          </div>
        </div>

        <!-- Consent (Loom + contact) -->
        <div class="mb-6">
          <label class="flex items-start gap-3">
            <input type="checkbox" id="consent_looom" name="consent_looom" required class="mt-1 w-4 h-4 text-violet-600 border-gray-600 rounded focus:ring-violet-500 focus:ring-2 bg-gray-800" />
            <span class="text-sm text-gray-400 leading-relaxed">
              I agree to receive a <strong>free 2-minute Loom</strong> using public information from my website and Google Business Profile. No account access is requested at this stage.
            </span>
          </label>
          <div class="text-red-400 text-sm mt-1" data-error-for="consent_looom" aria-live="polite"></div>
        </div>

        <div class="mb-8">
          <label class="flex items-start gap-3">
            <input type="checkbox" id="consent_contact" name="consent_contact" required class="mt-1 w-4 h-4 text-violet-600 border-gray-600 rounded focus:ring-violet-500 focus:ring-2 bg-gray-800" />
            <span class="text-sm text-gray-400 leading-relaxed">
              I agree to be contacted about my Sprint results (email, text or call). PIPEDA-aware: we collect minimal data and you can opt out anytime.
            </span>
          </label>
          <div class="text-red-400 text-sm mt-1" data-error-for="consent_contact" aria-live="polite"></div>
        </div>

        <button type="submit" class="w-full bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-bold py-4 px-8 rounded-xl hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-violet-500/25 disabled:opacity-50 disabled:cursor-not-allowed">
          Start My Free 72-Hour Sprint
        </button>

        <p class="text-xs text-slate-500 mt-3">Typical turnaround: 2–3 business days • Alberta businesses only</p>
      </form>
    </div>
  </div>
</section>

<!-- JSON-LD -->
<script type="application/ld+json">
  {JSON.stringify({
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebPage",
        url: `${siteUrl}/services/ads`,
        name: "Paid Media (Google & Meta) | BrandsBuilders Agency",
        description: seo.description,
        inLanguage: "en-CA",
        breadcrumb: {
          "@type": "BreadcrumbList",
          itemListElement: [
            { "@type": "ListItem", position: 1, name: "Home", item: siteUrl },
            { "@type": "ListItem", position: 2, name: "Services", item: `${siteUrl}/services` },
            { "@type": "ListItem", position: 3, name: "Paid Media", item: `${siteUrl}/services/ads` }
          ]
        },
        isPartOf: { "@type": "WebSite", url: siteUrl }
      },
      {
        "@type": "Service",
        name: "Paid Media (within Growth Partner)",
        serviceType: "Performance advertising",
        areaServed: [
          { "@type": "AdministrativeArea", name: "Alberta" },
          { "@type": "City", name: "Calgary" },
          { "@type": "City", name: "Edmonton" }
        ],
        provider: { "@type": "Organization", name: "BrandsBuilders Agency", url: siteUrl },
        offers: {
          "@type": "Offer",
          url: `${siteUrl}/services/ads`,
          availability: "https://schema.org/InStock"
        },
        description: "Audit, keyword research, ~$50/day initial data phase, negatives, CRO/A/B and iterative optimization to exceed target ROAS."
      },
      {
        "@type": "WebApplication",
        name: "Free 72-Hour Growth Sprint — Application",
        url: `${siteUrl}/services/ads#free-sprint`,
        description: "Free audit sprint for Alberta owner-led SMBs. 2-minute Loom with opportunities delivered within 72 hours.",
        applicationCategory: "BusinessApplication"
      },
      {
        "@type": "FAQPage",
        mainEntity: [
          { "@type": "Question", name: "Is this a standalone service?", acceptedAnswer: { "@type": "Answer", text: "No. We operate paid media only within our Growth Partner to align offers, landings, tracking and budgets." } },
          { "@type": "Question", name: "What’s the minimum media budget?", acceptedAnswer: { "@type": "Answer", text: "Roughly $50/day to collect initial data quickly; scaling depends on performance and volume." } },
          { "@type": "Question", name: "Do you add negative keywords?", acceptedAnswer: { "@type": "Answer", text: "Yes. We mine search terms weekly and add negatives continuously to protect ROAS." } },
          { "@type": "Question", name: "How do you improve ROAS?", acceptedAnswer: { "@type": "Answer", text: "Refine queries/bids, iterate creatives, and run A/B tests on landings to raise conversion rate and reallocate budget to winners." } }
        ]
      }
    ]
  })}
</script>

<!-- Minimal inline validation -->
<script is:inline>
  (function () {
    var form = document.querySelector('form[name="sprint-apply"]');
    if (!form) return;

    function err(el, msg) {
      var slot = form.querySelector('[data-error-for="' + (el.name || '') + '"]');
      if (slot) slot.textContent = msg || '';
    }

    var validators = {
      business_name: function (el) { return el.value.trim() ? '' : 'Please enter your business name.'; },
      site_url: function (el) {
        if (!el.value.trim()) return 'Please enter your website URL.';
        var ok = /^https?:\/\/[^\s/$.?#].[^\s]*$/i.test(el.value.trim());
        return ok ? '' : 'URL must start with http:// or https://';
      },
      city: function (el) { return el.value ? '' : 'Please select your city.'; },
      revenue: function (el) { return el.value ? '' : 'Please select a revenue range.'; },
      has_gbp: function () {
        var checked = form.querySelector('input[name="has_gbp"]:checked');
        return checked ? '' : 'Please select an option.';
      },
      platform: function (el) { return el.value ? '' : 'Please select your platform.'; },
      contact_pref: function () {
        var checked = form.querySelector('input[name="contact_pref"]:checked');
        return checked ? '' : 'Please select a contact method.';
      },
      email: function (el) {
        if (!el.value.trim()) return 'Please enter your email.';
        var ok = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(el.value);
        return ok ? '' : 'Enter a valid email address.';
      },
      consent_looom: function (el) { return el.checked ? '' : 'Consent to receive the Loom is required.'; },
      consent_contact: function (el) { return el.checked ? '' : 'Contact permission is required.'; }
    };

    // radios validated as groups by name
    var fields = Array.prototype.slice.call(form.elements).filter(function (el) {
      return ['business_name','site_url','city','revenue','platform','email','consent_looom','consent_contact'].includes(el.name)
             || el.name === 'has_gbp' || el.name === 'contact_pref';
    });

    fields.forEach(function (el) {
      var ev = (el.type === 'radio' || el.tagName === 'SELECT' || el.type === 'checkbox') ? 'change' : 'input';
      el.addEventListener(ev, function () {
        var name = el.name;
        var msg = '';
        if (name === 'has_gbp' || name === 'contact_pref') {
          msg = validators[name]();
        } else if (validators[name]) {
          msg = validators[name](el);
        }
        if (name === 'has_gbp') {
          var any = form.querySelector('input[name="has_gbp"]');
          if (any) err(any, msg);
        } else if (name === 'contact_pref') {
          var any2 = form.querySelector('input[name="contact_pref"]');
          if (any2) err(any2, msg);
        } else {
          err(el, msg);
        }
      });
    });

    form.addEventListener('submit', function (e) {
      var hasErrors = false;
      ['has_gbp','contact_pref'].forEach(function (group) {
        var msg = validators[group]();
        var any = form.querySelector('input[name="' + group + '"]');
        if (any) err(any, msg);
        if (msg) hasErrors = true;
      });
      fields.forEach(function (el) {
        if (el.type === 'radio') return;
        var msg = validators[el.name] ? validators[el.name](el) : '';
        err(el, msg);
        if (msg) hasErrors = true;
      });
      if (hasErrors) e.preventDefault();
    });
  })();
</script>

</Layout>
