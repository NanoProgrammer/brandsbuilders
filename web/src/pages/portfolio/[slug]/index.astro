---
/* src/pages/portfolio/[slug].astro
   Dynamic case-study page (static generated) with Recommended Plan */

export const prerender = true;
import Layout from '../../../layouts/Layout.astro';

type Entry = {
  slug: string;
  title: string;
  category: string;
  impact: string;
  image: string;
  year?: string;
  summary?: string;
  metrics?: Record<string, string>;
  services?: string[];
  stack?: string[];
  challenges?: string[];
  solutions?: string[];
  outcomes?: string[];
  testimonial?: {
    quote: string;
    author: string;
    role?: string;
    avatar?: string;
  };
};

const entries: Entry[] = [
  {
    slug: "luxe-med-spa",
    title: "Luxe Med Spa",
    category: "Healthcare & Beauty",
    impact: "300% more online bookings · First month",
    image: "/portfolio/luxe-med-spa.jpg",
    year: "2024",
    summary:
      "Rebrand + high-performance site focused on booking flow, credibility and Local SEO. Rolled out GBP and reviews engine with measurable lift.",
    metrics: { Bookings: "+300%", CPL: "-42%", "Mobile Lighthouse": "92" },
    services: ["Brand Identity", "Web Design", "Local SEO", "CRO", "GBP Setup"],
    stack: ["Astro", "Tailwind", "Cloudflare", "GA4", "GSC"],
    challenges: [
      "DIY brand and slow site hurt perceived quality",
      "Low GBP activity and few recent reviews",
      "Fragmented booking funnel on mobile",
    ],
    solutions: [
      "Identity refresh + CRO-first layout with trust modules",
      "Local on-page SEO + GBP optimization + reviews engine",
      "Event tracking and form/booking instrumentation",
    ],
    outcomes: [
      "Faster decision path and higher mobile conversion",
      "Consistent review velocity improves local rankings",
      "Clear analytics on lead quality and sources",
    ],
    testimonial: {
      quote:
        "Within six weeks we went from DIY to a credible brand with a fast site. Bookings jumped and lead quality improved right away.",
      author: "Dr. Alicia Harper",
      role: "Owner, Luxe Med Spa",
      avatar: "/people/alicia-harper.jpg",
    },
  },
  {
    slug: "mountain-view-dental",
    title: "Mountain View Dental",
    category: "Healthcare",
    impact: "60% fewer phone calls · 3 months",
    image: "/portfolio/mountain-dental.jpg",
    year: "2024",
    metrics: { Calls: "-60%", Appointments: "+180%", "Avg. Rating": "4.9★" },
    services: ["Web Development", "Patient Portal", "UX", "Local SEO"],
    stack: ["Astro", "Tailwind", "Cloudflare", "GA4"],
    challenges: [
      "High front-desk load answering repeat questions",
      "Outdated structure and slow mobile performance",
    ],
    solutions: [
      "Self-serve pages and FAQs + patient portal",
      "Speed upgrades and accessibility essentials",
    ],
    outcomes: [
      "Reduced operational load and faster intakes",
      "Clearer path to booking from mobile",
    ],
  },
  {
    slug: "alberta-solar-co",
    title: "Alberta Solar Co",
    category: "Energy & Sustainability",
    impact: "150+ qualified leads · First quarter",
    image: "/portfolio/alberta-solar.jpg",
    year: "2024",
    metrics: { Leads: "150+", CAC: "-28%", Conv: "4.7%" },
    services: ["Lead Gen", "Local SEO", "CRO", "Analytics"],
    stack: ["Astro", "Tailwind", "Cloudflare", "GA4", "GSC"],
  },
  {
    slug: "prairie-law-group",
    title: "Prairie Law Group",
    category: "Legal Services",
    impact: "200% more consultations · 6 months",
    image: "/portfolio/prairie-law.jpg",
    year: "2023",
    metrics: { Consultations: "+200%", Referrals: "+120%" },
    services: ["Brand Identity", "Professional Web", "Client Portal"],
    stack: ["Astro", "Tailwind", "Cloudflare"],
  },
  {
    slug: "urban-fitness-club",
    title: "Urban Fitness Club",
    category: "Health & Fitness",
    impact: "180% more memberships · 4 months",
    image: "/portfolio/urban-fitness.jpg",
    year: "2024",
    metrics: { Memberships: "+180%", Retention: "+65%", Revenue: "+220%" },
    services: ["Web Development", "Booking System", "Member Portal"],
    stack: ["Astro", "Tailwind", "Stripe", "Cloudflare"],
  },
  {
    slug: "calgary-tech-startup",
    title: "Calgary Tech Startup",
    category: "Technology",
    impact: "15% conversion rate · Launch period",
    image: "/portfolio/tech-startup.jpg",
    year: "2024",
    metrics: { Conversion: "15%", Funding: "$2M", Signups: "+400%" },
    services: ["Product Design", "CRO", "Brand Strategy"],
    stack: ["Astro", "Tailwind", "Cloudflare"],
  },
];

/* ===== Plans pulled from your Services & Pricing ===== */
type Plan = {
  id: string;
  name: string;
  price: string;
  timeline?: string;
  bullets: string[];
  anchor?: string; // for /services#anchor link
};
const plans: Record<string, Plan> = {
  "go-to-market": {
    id: "go-to-market",
    name: "Go-to-Market Launch",
    price: "$2,000–$3,200",
    bullets: [
      "Brand Launch (light)",
      "CRO-first landing (5–7 sections)",
      "Tech SEO + Analytics/Events",
      "GBP setup & optimization",
    ],
    anchor: "go-to-market-launch",
  },
  "local-service-site": {
    id: "local-service-site",
    name: "Local Service Site (3–7 pages)",
    price: "$3,000–$4,500",
    bullets: [
      "Brand Launch (light) + multipage site",
      "Local on-page SEO + GBP",
      "Social kit (templates/guide)",
      "Review prompts setup",
    ],
    anchor: "local-service-site",
  },
  "content-system": {
    id: "content-system",
    name: "Content System & On-Page Lift",
    price: "$2,500–$5,000",
    bullets: [
      "CMS models (Blog/Case/Category)",
      "On-page for 10–20 key URLs",
      "Article/FAQ/Breadcrumb schema",
      "90-day editorial playbook",
    ],
    anchor: "content-system-onpage",
  },
  "rebrand-foundation": {
    id: "rebrand-foundation",
    name: "Rebrand & Site Foundation (10–20) + CMS",
    price: "$7,500–$12,500",
    bullets: [
      "Full identity system",
      "Component library + CMS",
      "Tech + on-page base",
      "Mobile 90+ / AA essentials",
    ],
    anchor: "rebrand-site-foundation",
  },
};

/** Select a recommended plan based on project vertical/slug */
function selectPlan(e: Entry): Plan {
  const c = e.category.toLowerCase();
  if (c.includes("healthcare") || c.includes("fitness") || c.includes("beauty")) {
    return plans["local-service-site"];
  }
  if (c.includes("legal")) {
    return plans["rebrand-foundation"];
  }
  if (c.includes("energy") || c.includes("sustainability")) {
    return plans["content-system"];
  }
  if (c.includes("technology") || e.slug.includes("startup")) {
    return plans["go-to-market"];
  }
  // default
  return plans["local-service-site"];
}

export async function getStaticPaths() {
  const entries: Entry[] = [
  {
    slug: "luxe-med-spa",
    title: "Luxe Med Spa",
    category: "Healthcare & Beauty",
    impact: "300% more online bookings · First month",
    image: "/portfolio/luxe-med-spa.jpg",
    year: "2024",
    summary:
      "Rebrand + high-performance site focused on booking flow, credibility and Local SEO. Rolled out GBP and reviews engine with measurable lift.",
    metrics: { Bookings: "+300%", CPL: "-42%", "Mobile Lighthouse": "92" },
    services: ["Brand Identity", "Web Design", "Local SEO", "CRO", "GBP Setup"],
    stack: ["Astro", "Tailwind", "Cloudflare", "GA4", "GSC"],
    challenges: [
      "DIY brand and slow site hurt perceived quality",
      "Low GBP activity and few recent reviews",
      "Fragmented booking funnel on mobile",
    ],
    solutions: [
      "Identity refresh + CRO-first layout with trust modules",
      "Local on-page SEO + GBP optimization + reviews engine",
      "Event tracking and form/booking instrumentation",
    ],
    outcomes: [
      "Faster decision path and higher mobile conversion",
      "Consistent review velocity improves local rankings",
      "Clear analytics on lead quality and sources",
    ],
    testimonial: {
      quote:
        "Within six weeks we went from DIY to a credible brand with a fast site. Bookings jumped and lead quality improved right away.",
      author: "Dr. Alicia Harper",
      role: "Owner, Luxe Med Spa",
      avatar: "/people/alicia-harper.jpg",
    },
  },
  {
    slug: "mountain-view-dental",
    title: "Mountain View Dental",
    category: "Healthcare",
    impact: "60% fewer phone calls · 3 months",
    image: "/portfolio/mountain-dental.jpg",
    year: "2024",
    metrics: { Calls: "-60%", Appointments: "+180%", "Avg. Rating": "4.9★" },
    services: ["Web Development", "Patient Portal", "UX", "Local SEO"],
    stack: ["Astro", "Tailwind", "Cloudflare", "GA4"],
    challenges: [
      "High front-desk load answering repeat questions",
      "Outdated structure and slow mobile performance",
    ],
    solutions: [
      "Self-serve pages and FAQs + patient portal",
      "Speed upgrades and accessibility essentials",
    ],
    outcomes: [
      "Reduced operational load and faster intakes",
      "Clearer path to booking from mobile",
    ],
  },
  {
    slug: "alberta-solar-co",
    title: "Alberta Solar Co",
    category: "Energy & Sustainability",
    impact: "150+ qualified leads · First quarter",
    image: "/portfolio/alberta-solar.jpg",
    year: "2024",
    metrics: { Leads: "150+", CAC: "-28%", Conv: "4.7%" },
    services: ["Lead Gen", "Local SEO", "CRO", "Analytics"],
    stack: ["Astro", "Tailwind", "Cloudflare", "GA4", "GSC"],
  },
  {
    slug: "prairie-law-group",
    title: "Prairie Law Group",
    category: "Legal Services",
    impact: "200% more consultations · 6 months",
    image: "/portfolio/prairie-law.jpg",
    year: "2023",
    metrics: { Consultations: "+200%", Referrals: "+120%" },
    services: ["Brand Identity", "Professional Web", "Client Portal"],
    stack: ["Astro", "Tailwind", "Cloudflare"],
  },
  {
    slug: "urban-fitness-club",
    title: "Urban Fitness Club",
    category: "Health & Fitness",
    impact: "180% more memberships · 4 months",
    image: "/portfolio/urban-fitness.jpg",
    year: "2024",
    metrics: { Memberships: "+180%", Retention: "+65%", Revenue: "+220%" },
    services: ["Web Development", "Booking System", "Member Portal"],
    stack: ["Astro", "Tailwind", "Stripe", "Cloudflare"],
  },
  {
    slug: "calgary-tech-startup",
    title: "Calgary Tech Startup",
    category: "Technology",
    impact: "15% conversion rate · Launch period",
    image: "/portfolio/tech-startup.jpg",
    year: "2024",
    metrics: { Conversion: "15%", Funding: "$2M", Signups: "+400%" },
    services: ["Product Design", "CRO", "Brand Strategy"],
    stack: ["Astro", "Tailwind", "Cloudflare"],
  },
];
  return entries.map((e) => ({
    params: { slug: e.slug },
    props: e,
  }));
}

const project = Astro.props as Entry;
const {
  slug,
  title,
  category,
  impact,
  image,
  year = "",
  summary,
  metrics = {},
  services = [],
  stack = [],
  challenges = [],
  solutions = [],
  outcomes = [],
  testimonial,
} = project;

const recommended = selectPlan(project);

const seo = {
  title: `${title} — Case Study | BrandsBuilders`,
  description: `${title}: ${impact}. ${summary ?? "Case study: credibility, qualified leads & revenue growth."}`,
  canonical: `https://brandsbuilders.agency/portfolio/${slug}`,
};
---

<Layout seo={seo}>
  <!-- HERO -->
  <section class="relative overflow-hidden">
    <div class="absolute inset-0 opacity-25 bg-[radial-gradient(60%_60%_at_50%_40%,rgba(139,92,246,.35),transparent_70%)]"></div>

    <div class="container mx-auto px-6 pt-16 pb-10 relative z-10">
      <nav class="mb-6 text-sm text-slate-400">
        <a href="/portfolio" class="hover:text-white">Portfolio</a>
        <span class="mx-2">/</span>
        <span class="text-slate-300">{title}</span>
      </nav>

      <div class="max-w-3xl">
        <h1 class="text-4xl md:text-6xl font-black tracking-tight">
          {title}
        </h1>
        <p class="mt-3 text-violet-300 font-medium">
          {category}{year && ` · ${year}`}
        </p>
        <p class="mt-2 text-slate-300">{impact}</p>
      </div>

      <div class="mt-8 rounded-3xl overflow-hidden border border-slate-800">
        <img
          src={image}
          alt={title}
          class="w-full h-[42vh] md:h-[56vh] object-cover"
          loading="lazy"
        />
      </div>

      <div class="mt-8 flex flex-wrap gap-3">
        <a href="/contact" class="inline-flex items-center px-5 py-3 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 font-semibold hover:opacity-95 transition">
          Get a proposal
        </a>
        <a href="/portfolio" class="inline-flex items-center px-5 py-3 rounded-xl border border-slate-700 hover:border-violet-500/50 hover:bg-violet-500/10 transition">
          Back to all projects
        </a>
      </div>
    </div>
  </section>

  <!-- BODY -->
  <section class="py-12">
    <div class="container mx-auto px-6 grid lg:grid-cols-3 gap-8">
      <!-- Main -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Overview -->
        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
          <h2 class="text-xl font-bold mb-2">Overview</h2>
          <p class="text-slate-300">
            {summary ?? "Brief case study goes here. Replace this text with your challenge → solution → outcome summary."}
          </p>
        </div>

        <!-- Outcomes & Metrics -->
        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
            <h2 class="text-xl font-bold mb-2">Key Outcomes</h2>
            <ul class="text-slate-300 list-disc pl-5 space-y-1">
              {outcomes.length ? outcomes.map((o) => <li>{o}</li>) : (
                <>
                  <li>Speed, accessibility and SEO foundations shipped.</li>
                  <li>Ownership & hand-off with analytics configured.</li>
                </>
              )}
            </ul>
          </div>
          <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
            <h2 class="text-xl font-bold mb-2">Results</h2>
            <ul class="text-slate-300 grid grid-cols-2 gap-y-2">
              {Object.keys(metrics).length
                ? Object.entries(metrics).map(([k, v]) => (
                  <li class="flex items-center justify-between">
                    <span class="text-slate-400">{k}</span>
                    <span class="text-violet-300 font-semibold">{v}</span>
                  </li>
                ))
                : (
                  <>
                    <li class="flex items-center justify-between">
                      <span class="text-slate-400">Impact</span>
                      <span class="text-violet-300 font-semibold">{impact}</span>
                    </li>
                  </>
                )
              }
            </ul>
          </div>
        </div>

        <!-- Challenge → Solution -->
        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <h3 class="text-lg font-semibold mb-2">Challenges</h3>
              <ul class="text-slate-300 list-disc pl-5 space-y-1">
                {challenges?.length ? challenges.map((c) => <li>{c}</li>) : (
                  <>
                    <li>Low credibility and slow mobile experience.</li>
                    <li>Fragmented conversion path.</li>
                  </>
                )}
              </ul>
            </div>
            <div>
              <h3 class="text-lg font-semibold mb-2">Solution</h3>
              <ul class="text-slate-300 list-disc pl-5 space-y-1">
                {solutions?.length ? solutions.map((s) => <li>{s}</li>) : (
                  <>
                    <li>CRO-first templates with trust modules and reviews.</li>
                    <li>Local on-page and event tracking for decisions.</li>
                  </>
                )}
              </ul>
            </div>
          </div>
        </div>

        <!-- Testimonial -->
        {testimonial && (
          <figure class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
            <blockquote class="text-slate-200 text-lg leading-relaxed">“{testimonial.quote}”</blockquote>
            <figcaption class="mt-4 flex items-center gap-3">
              {testimonial.avatar && (
                <img src={testimonial.avatar} alt={testimonial.author} class="w-10 h-10 rounded-xl object-cover border border-slate-700" loading="lazy" />
              )}
              <div>
                <p class="text-white font-semibold">{testimonial.author}</p>
                {testimonial.role && <p class="text-slate-400 text-sm">{testimonial.role}</p>}
              </div>
            </figcaption>
          </figure>
        )}
      </div>

      <!-- Sidebar -->
      <aside class="space-y-6">
        <!-- Recommended Plan -->
        <div class="rounded-2xl p-6 border border-violet-900/40 bg-gradient-to-br from-slate-900/70 to-slate-900/20">
          <div class="mb-3 inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs border border-violet-500/30 text-violet-200 bg-violet-500/10">
            Recommended Plan
          </div>
          <h3 class="text-white font-semibold text-lg mb-1">{recommended.name}</h3>
          <p class="text-slate-400 text-sm mb-4">
            {recommended.timeline ?? "Typical timeline: 30–45 days"}
          </p>

          <ul class="space-y-2 mb-4">
            {recommended.bullets.map((b) => (
              <li class="flex items-start gap-2 text-slate-300 text-sm">
                <span class="mt-1 w-1.5 h-1.5 rounded-full bg-violet-400"></span>{b}
              </li>
            ))}
          </ul>

          <div class="flex items-center justify-between mb-4">
            <span class="text-violet-300 font-semibold">{recommended.price}</span>
            <a href="/contact" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white text-sm font-semibold hover:opacity-95 transition">
              Request this plan
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7-7 7M21 12H3"/></svg>
            </a>
          </div>

          <div class="text-[11px] text-slate-400">
            Reserve your slot with a <span class="text-white font-medium">50% upfront deposit</span> of the minimum price (non-refundable once work begins). Full details in our
            <a href="/terms-of-service" class="text-violet-300 underline">Terms of Service</a>.
          </div>

          <div class="mt-4 text-[11px] text-slate-400">
            <span class="text-slate-300">Includes 12-month freebies:</span> 1 domain + privacy, 1 custom inbox credit, DNS & SSL setup/management.
          </div>

          {recommended.anchor && (
            <a href={`/services#${recommended.anchor}`} class="mt-3 inline-flex items-center gap-2 text-violet-300 hover:text-white text-xs underline">
              See full plan details
            </a>
          )}
        </div>

        <!-- Services & Stack -->
        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
          <h3 class="font-semibold mb-3">Services Included</h3>
          <div class="flex flex-wrap gap-2">
            {(services.length ? services : ["Brand / Web", "Local SEO / CRO", "Analytics setup"]).map((s) => (
              <span class="px-3 py-1 text-xs bg-slate-800 text-slate-300 rounded-full border border-slate-700">{s}</span>
            ))}
          </div>
        </div>

        {stack.length > 0 && (
          <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
            <h3 class="font-semibold mb-3">Stack</h3>
            <div class="flex flex-wrap gap-2">
              {stack.map((s) => (
                <span class="px-3 py-1 text-xs bg-slate-800 text-slate-300 rounded-full border border-slate-700">{s}</span>
              ))}
            </div>
          </div>
        )}

        <!-- Key Policies (aligned with ToS) -->
        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
          <h3 class="font-semibold mb-3">Key Policies</h3>
          <ul class="text-slate-300 text-sm space-y-2">
            <li><strong class="text-violet-300">Performance target:</strong> mobile Lighthouse ≥90 & LCP &lt;2.5s (trade-offs documented).</li>
            <li><strong class="text-violet-300">Accessibility:</strong> WCAG 2.1 A/AA essentials on shipped templates.</li>
            <li><strong class="text-violet-300">Warranty:</strong> 30-day bug-fix (checkout blockers: 60 days).</li>
            <li><strong class="text-violet-300">Ownership:</strong> final deliverables transfer after full payment.</li>
          </ul>
          <p class="text-slate-400 text-xs mt-3">See our <a href="/terms-of-service" class="text-violet-300 underline">Terms of Service</a>.</p>
        </div>

        <!-- Next steps -->
        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6">
          <h3 class="font-semibold mb-2">Next steps</h3>
          <div class="flex flex-col gap-3">
            <a href="/services" class="inline-flex items-center justify-center px-4 py-2 rounded-lg border border-slate-700 hover:border-violet-500/50 hover:bg-violet-500/10 transition">
              Explore services
            </a>
            <a href="/contact" class="inline-flex items-center justify-center px-4 py-2 rounded-lg bg-gradient-to-r from-violet-600 to-fuchsia-600 font-semibold hover:opacity-95 transition">
              Book a call
            </a>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- JSON-LD Case Study -->
  <script type="application/ld+json">
    {JSON.stringify({
      "@context": "https://schema.org",
      "@type": "CaseStudy",
      name: title,
      image,
      about: category,
      description: seo.description,
      url: seo.canonical,
      genre: "Brand, Web, Local SEO & Media",
      outcome: impact,
      isPartOf: {
        "@type": "Product",
        name: recommended.name,
        offers: {
          "@type": "Offer",
          price: recommended.price.replace(/[^0-9–-]/g, ""),
          priceCurrency: "CAD",
          url: `https://brandsbuilders.agency/services#${recommended.anchor ?? ""}`
        }
      }
    })}
  </script>
</Layout>
