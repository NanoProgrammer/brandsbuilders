---
// @ts-check
import "../styles/global.css";

import HeadSEO from "../components/seo/HeadSEO.astro";
import NavBar from "../components/ui/NavBar.astro";
import Footer from "../components/ui/Footer.astro";

type JSONLike = any;
interface Props {
  title: string;
  description: string;
  canonical?: string;
  image?: string;       // e.g. "/og.jpg"
  noindex?: boolean;
  jsonLd?: JSONLike | JSONLike[];
}

const {
  title,
  description,
  image = "/og.jpg",
  noindex = false,
  jsonLd = [],
} = Astro.props as Props;

// Canonical por defecto = URL actual
const canonical =
  (Astro.props as Props).canonical ??
  Astro.url?.href ??
  "https://brandsbuilders.agency";
---
<html lang="en-CA" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- SEO (metas OG/Twitter + canonical + robots) -->
    <HeadSEO {title} {description} {canonical} image={image} noindex={noindex} jsonLd={jsonLd} />

    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#0b0f14" />

    <!-- AOS CSS sin Astro.resolve -->
    <style is:global>
      @import "aos/dist/aos.css";
    </style>
  </head>

  <body class="bg-[#0b0f14] text-white antialiased">
    <!-- Skip link accesible -->
    <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 bg-white text-black rounded px-3 py-2">
      Skip to content
    </a>

    <!-- Fondo con gradientes sutiles -->
    <div class="pointer-events-none fixed inset-0 -z-10">
      <div class="absolute -top-32 -left-32 h-80 w-80 rounded-full blur-3xl opacity-20"
           style="background: radial-gradient(60% 60% at 50% 50%, #4de2ff33 0%, transparent 70%);"></div>
      <div class="absolute -bottom-32 -right-32 h-96 w-96 rounded-full blur-3xl opacity-20"
           style="background: radial-gradient(60% 60% at 50% 50%, #7c5cff33 0%, transparent 70%);"></div>
    </div>

    <!-- Header con fallback -->
    <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-black/30 border-b border-white/10">
      <slot name="header">
        <NavBar />
      </slot>
    </header>

    <!-- Contenido principal -->
    <main id="main" class="min-h-dvh">
      <slot />
    </main>

    <!-- Footer con fallback -->
    <footer class="border-t border-white/10">
      <slot name="footer">
        <Footer />
      </slot>
    </footer>

    <!-- Enhancements: Lenis + AOS (client-only, opcionales) -->
    <script type="module">
      (async () => {
        try {
          const [{ default: AOS }, { default: Lenis }] = await Promise.all([
            import("aos"),
            import("lenis"),
          ]);

          AOS.init({ once: true, duration: 700, easing: "ease-out" });

          const lenis = new Lenis({ smoothWheel: true });
          const raf = (t) => { lenis.raf(t); requestAnimationFrame(raf); };
          requestAnimationFrame(raf);
        } catch (e) {
          /* Enhancements off: no rompe nada si no est√°n */
        }
      })();
    </script>
  </body>
</html>
